// fetch data from json api generated by the python recommender

const UrlParam = new URLSearchParams(window.location.search)
const song = UrlParam.get('song')

let currentSongTitle = '';

if (song){
    fetch(`http://127.0.0.1:5000/get_video?song=${song}`).then(res => res.json()).then(data => {
        if(data.success){
            currentSongTitle = data.video_title;
            const heading = document.getElementById('song_title');
            heading.innerText = data.video_title;
            const song_frame = document.getElementById('song-frame');
            song_frame.src = `https://www.youtube.com/embed/${data.video_id}`;
            const song_thumbnail = document.getElementById('song-thumbnail');
            song_thumbnail.src = `${data.video_thumbnails_links[0]}`;
            const song_info = document.getElementById('song-info');
            song_info.innerText = `Channel: ${data.channel_name} | Views: ${data.video_short_views}`;
            console.log(data.video_id);
            document.getElementsByClassName('image-loading')[0].style.display = 'none';
        }
    })
}

// function to play song
function playSong(){
    const song = encodeURIComponent(currentSongTitle.trim());
    // document.getElementById('loading').style.display = 'block';
    fetch('http://127.0.0.1:5000/play', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ song: song })
    }).then(response => response.json()).then(data => {
        document.getElementById('loading').style.display = 'none';
        console.log(data);
    });
}

// function to pause song
function pauseSong() {
    fetch('http://127.0.0.1:5000/pause', {
      method: 'POST'
    })
    .then(response => response.json())
    .then(data => console.log(data));
}